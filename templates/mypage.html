<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Webpage Title -->
    <title>오늘 뭐 먹지? | Mypage</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--파비콘-->
    <link rel="shortcut icon" type="image/x-icon" href="/static/favicon2.ico" />

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <!-- 구글 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">

    <!-- CSS -->
    <!--<link href="{{ url_for('static', filename='mycss.css') }}" rel="stylesheet">-->
    <link href="../static/mycss.css" rel="stylesheet">

    <!--JS 파일-->
    <script src="../static/myjs.js" rel="script"></script>
    <!--<script src="{{ url_for('static', filename='myjs.js') }}"></script>-->

    <script>
        function sign_out() {
            $.removeCookie('mytoken', {path: '/'});
            alert('로그아웃!')
            window.location.href = '/'
        }

        function update_profile() {
            let file = $('#input-pic')[0].files[0]
            let about = $('#textarea-about').val()
            let form_data = new FormData()
            form_data.append('file_give', file)
            form_data.append('about_give', about)
            console.log(file, about, form_data)

            $.ajax({
                type: 'POST',
                url: '/update_profile',
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function(response) {
                    if (response['result'] === "success") {
                        alert(response["msg"])
                        window.location.reload()
                    }
                }
            })
        }

        function get_post(username) {
            if (username === undefined) {
                username = ""
            }
            $("#post-box").empty()
            $.ajax({
                type: 'GET',
                url: `/get_post?username_give=${username}`,
                data: {},
                success: function(response) {
                    if (response['result'] === success) {
                        let posts = response['posts']
                        for (let i = 0; i < posts.lengh; i++) {
                            let post = posts[i]
                            let time_post = new Date(post["date"])
                            let html_temp = `<div class="card">
                                                <div class="card-image">
                                                    <figure class="image is-4by3">
                                                        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
                                                    </figure>
                                                </div>
                                                <div class="card-content">
                                                    <div class="media">
                                                        <div class="media-left">
                                                            <figure class="image is-48x48">
                                                                <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                                                            </figure>
                                                        </div>
                                                        <div class="media-content">
                                                            <p class="title is-4">장민</p>
                                                            <p class="subtitle is-6">@jangmin123</p>
                                                        </div>
                                                    </div>
                                                    <div class="content">
                                                        오늘 저녁은 이것이 어떤지 모르것는디?
                                                        <br>
                                                        <div class="like">
                                                            <span class="icon is-small">
                                                                <i class="fa fa-heart" aria-hidden="true" style="color:orangered;">♥</i>
                                                                <span class="like-num">12</span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>`
                            $('#post-box').append(html_temp)
                        }
                    }
                }
            })
        }
    </script>
</head>
<body>
<!--타이틀부분-->
    <header>
        <nav class="navbar" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a class="navbar-item" href="#">
                    오늘 뭐 먹지?
                </a>
            </div>
            <div id="navbarBasicExample" class="navbar-menu">
                <div class="navbar-end">
                    <div class="navbar-item">
                        <div class="buttons">
                            <a class="button log-in is-primary" onclick="sign_out()">
                                <strong>로그아웃</strong>
                            </a>
                            <a class="button is-light" onclick="location.href = '/'">
                                홈으로
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <section class="sub-hero">
            <div class="hero-body has-text-centered">
                <p class="main-title">
                    오늘 뭐 먹지?
                </p>
                <p class="sub-title">
                    간단한 질문에 답하고, 오늘의 식사를 추천 받아 보세요!
                </p>
            </div>
        </section>
        <section class="profile-hero">
            <div class="hero-body user-info">
                <article class="media">

                    <figure class="media-center">
                        <a class="image is-96x96" href="#">
                            <img class="is-rounded" src="/static/profile_placeholder.png">
                        </a>
                    </figure>
                    <div class="media-content">
                        <div class="content">
                            <p>
                                <strong> {{ user_info.id }} </strong>
                                <br>
                                 {{ user_info.profile }}
                            </p>
                        </div>
                    </div>
                    {% if status %}
                        <button class="button edit" onclick="$('#modal-edit').addClass('is-active')">프로필 수정</button>
                    {% endif %}
                </article>
            </div>
        </section>
    </header>
    <main>
        <select class="dropdown" id="dropdown" name="sort" onchange="">
            <option value="sort-all">전체보기</option>
            <option value="sort-postion">추천한 음식별</option>
            <option value="sort-liked">좋아한 음식별</option>
        </select>
        <div class="cards-4" id="post-box">
            <div class="card">
                <div class="card-image">
                    <figure class="image is-4by3">
                        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
                    </figure>
                </div>
                <div class="card-content">
                    <div class="media">
                        <div class="media-left">
                            <figure class="image is-48x48">
                                <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                            </figure>
                        </div>
                        <div class="media-content">
                            <p class="title is-4">장민</p>
                            <p class="subtitle is-6">@jangmin123</p>
                        </div>
                    </div>
                    <div class="content">
                        오늘 저녁은 이것이 어떤지 모르것는디?
                        <br>
                        <div class="like">
                            <span class="icon is-small">
                                <i class="fa fa-heart" aria-hidden="true" style="color:orangered;">♥</i>
                                <span class="like-num">12</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-image">
                    <figure class="image is-4by3">
                        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
                    </figure>
                </div>
                <div class="card-content">
                    <div class="media">
                        <div class="media-left">
                            <figure class="image is-48x48">
                                <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                            </figure>
                        </div>
                        <div class="media-content">
                            <p class="title is-4">장민</p>
                            <p class="subtitle is-6">@jangmin123</p>
                        </div>
                    </div>
                    <div class="content">
                        오늘 저녁은 이것이 어떤지 모르것는디?
                        <br>
                        <div class="like">
                            <span class="icon is-small">
                                <i class="fa fa-heart" aria-hidden="true" style="color:orangered;">♥</i>
                                <span class="like-num">12</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-image">
                    <figure class="image is-4by3">
                        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
                    </figure>
                </div>
                <div class="card-content">
                    <div class="media">
                        <div class="media-left">
                            <figure class="image is-48x48">
                                <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                            </figure>
                        </div>
                        <div class="media-content">
                            <p class="title is-4">장민</p>
                            <p class="subtitle is-6">@jangmin123</p>
                        </div>
                    </div>
                    <div class="content">
                        오늘 저녁은 이것이 어떤지 모르것는디?
                        <br>
                        <div class="like">
                            <span class="icon is-small">
                                <i class="fa fa-heart" aria-hidden="true" style="color:orangered;">♥</i>
                                <span class="like-num">12</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-image">
                    <figure class="image is-4by3">
                        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
                    </figure>
                </div>
                <div class="card-content">
                    <div class="media">
                        <div class="media-left">
                            <figure class="image is-48x48">
                                <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                            </figure>
                        </div>
                        <div class="media-content">
                            <p class="title is-4">장민</p>
                            <p class="subtitle is-6">@jangmin123</p>
                        </div>
                    </div>
                    <div class="content">
                        오늘 저녁은 이것이 어떤지 모르것는디?
                        <br>
                        <div class="like">
                            <span class="icon is-small">
                                <i class="fa fa-heart" aria-hidden="true" style="color:orangered;">♥</i>
                                <span class="like-num">12</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal" id="modal-edit">
            <div class="modal-background" onclick='$("#modal-edit").removeClass("is-active")'></div>
            <div class="modal-content">
                <div class="box">
                    <article class="media">
                        <div class="media-content">
                            <div class="field">
                                <label class="label" for="input-name">ID</label>

                                <p class="control">
                                    {{ user_info['id'] }}
                                </p>
                            </div>
                            <div class="field">
                                <label class="label" for="input-pic">프로필 사진</label>

                                <div class="control is-expanded">
                                    <div class="file has-name">
                                        <label class="file-label" style="width:100%">
                                            <input id="input-pic" class="file-input" type="file"
                                                   name="resume">
                                            <span class="file-cta"><span class="file-icon"><i
                                                    class="fa fa-upload"></i></span>
                                <span class="file-label">파일 선택</span>
                            </span>
                                            <span id="file-name" class="file-name"
                                                  style="width:100%;max-width:100%">{# {{ user_info.profile_pic }} #}</span>
                                        </label>
                                    </div>

                                </div>
                            </div>
                            <div class="field">
                                <label class="label" for="textarea-about">나는 누구?</label>

                                <p class="control">

                        <textarea id="textarea-about" class="textarea"
                                  placeholder="자기소개하기">{# {{ user_info.profile_info }} #}</textarea>
                                </p>
                            </div>
                            <nav class="level is-mobile">
                                <div class="level-left">

                                </div>
                                <div class="level-right">
                                    <div class="level-item">
                                        <a class="button is-update" onclick="update_profile()">업데이트</a>
                                    </div>
                                    <div class="level-item">
                                        <a class="button is-cancel"
                                           onclick='$("#modal-edit").removeClass("is-active")'>취소</a>
                                    </div>
                                </div>
                            </nav>
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </main>
</body>
</html>